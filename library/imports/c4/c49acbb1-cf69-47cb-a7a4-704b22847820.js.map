{"version":3,"sources":["assets\\Script\\Weapon\\MollyThrower.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameController from \"../Controller/GameController\";\nimport Utils from \"../Controller/Utils\";\nimport Item from \"../Item/Item\";\nimport ProjectilePooling from \"../Manager/ProjectilePooling\";\nimport ThrowableProjectile from \"./ThrowableProjectile\";\nimport Weapon from \"./Weapon\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class MollyThrower extends Weapon {\n  static instance: MollyThrower;\n  @property(cc.Prefab)\n  molly: cc.Prefab = null;\n  @property(cc.Node)\n  player: cc.Node = null;\n  @property(cc.Node)\n  parent: cc.Node = null;\n  @property(cc.AudioClip)\n  throwSound: cc.AudioClip = null;\n  timer: number;\n  durationPercentage: number;\n  currentLevel = this.level;\n\n  onLoad() {\n    MollyThrower.instance = this;\n    this.weaponOnLoad();\n    this.durationPercentage = 0;\n    this.timer = 0;\n    let initCount = 10;\n    this.description = \"Throw a fire ball\";\n    for (let i = 0; i < initCount; ++i) {\n      let molly = cc.instantiate(this.molly);\n      molly.parent = this.node.parent.parent;\n      ProjectilePooling.instance.mollyPool.put(molly);\n    }\n  }\n  throwMolly() {\n    if (this.timer < 0) {\n      this.timer = this.attackSpeed;\n      if (Utils.getLocal(\"Sound\") == \"true\")\n        cc.audioEngine.play(this.throwSound, false, 1);\n      if (this.level < 3) {\n        this.spawnMolly(\n          cc.v3(\n            Utils.random(this.player.x - 500, this.player.x + 500),\n            Utils.random(this.player.y - 500, this.player.y + 500)\n          )\n        );\n        return;\n      }\n      if (this.level >= 7) {\n        for (let i = 0; i < 3; i++) {\n          this.spawnMolly(\n            cc.v3(\n              Utils.random(this.player.x - 500, this.player.x + 500),\n              Utils.random(this.player.y - 500, this.player.y + 500)\n            )\n          );\n        }\n        return;\n      }\n      if (this.level >= 3) {\n        for (let i = 0; i < 2; i++) {\n          this.spawnMolly(\n            cc.v3(\n              Utils.random(this.player.x - 500, this.player.x + 500),\n              Utils.random(\n                this.player.parent.y - 500,\n                this.player.parent.y + 500\n              )\n            )\n          );\n        }\n        return;\n      }\n    }\n  }\n  spawnMolly(target: cc.Vec3) {\n    let molly: cc.Node = null;\n    if (ProjectilePooling.instance.mollyPool.size() > 0) {\n      molly = ProjectilePooling.instance.mollyPool.get();\n    } else {\n      molly = cc.instantiate(this.molly);\n    }\n\n    molly.opacity = 0;\n    cc.tween(molly).to(0.05, { opacity: 255 }).start();\n    molly.parent = this.parent;\n\n    molly\n      .getComponent(ThrowableProjectile)\n      .set(\n        this.resultDamagePercentage,\n        this.baseDamage,\n        this.resultWeaponScalePercentage,\n        this.durationPercentage,\n        target,\n        this.player.position\n      );\n  }\n  onLevelUp() {\n    if (this.isLockLevel) return;\n    if (this.currentLevel < this.level) {\n      this.onLevelMax();\n      this.currentLevel = this.level;\n      switch (this.level) {\n        case 1:\n          this.description = \"Increase damage by 30%\";\n          this.isEquiped = true;\n          GameController.instance.addEquipedWeapon(this);\n          break;\n        case 2:\n          this.description = \"Add one more fire ball\";\n          this.updateStats(30, 0, 0, 0, 0);\n          break;\n        case 3:\n          this.description = \"Reduce time between attacks by 20%\";\n\n          break;\n        case 4:\n          this.description = \"Increase damage by 30%\";\n          this.updateStats(0, 0, 20, 0, 0);\n          break;\n        case 5:\n          this.description = \"Increase radius by 30%, duration by 20%\";\n          this.updateStats(30, 0, 0, 0, 0);\n          break;\n        case 6:\n          this.description = \"Add one more fire ball, increase radius by 30%\";\n          this.updateStats(0, 0, 0, 30, 20);\n          break;\n        case 7:\n          this.updateStats(0, 0, 0, 30, 0);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n  updateStats(\n    damagePercentage: number,\n    baseDamage: number,\n    attackSpeedPercentage: number,\n    weaponScalePercentage: number,\n    durationPercentage: number\n  ) {\n    this.damagePercentage += damagePercentage;\n    this.baseDamage += baseDamage;\n    this.attackSpeedPercentage += attackSpeedPercentage;\n    this.weaponScalePercentage += weaponScalePercentage;\n    this.durationPercentage += durationPercentage;\n    this.onStatChange();\n  }\n  start() {}\n\n  update(dt) {\n    this.onLevelUp();\n    if (Utils.isPause) return;\n    if (!this.isEquiped) return;\n    this.timer -= dt;\n    this.throwMolly();\n  }\n}\n"]}
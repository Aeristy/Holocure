{"version":3,"sources":["assets\\Script\\Weapon\\OrbitProjectile.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport Utils from \"../Controller/Utils\";\nimport EnemyController from \"../Enemy/EnemyController\";\nimport ProjectilePooling from \"../Manager/ProjectilePooling\";\nimport Projectile from \"./Projectile\";\nimport ShurikenThrower from \"./ShurikenThrower\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class OrbitProjectile extends Projectile {\n  @property(cc.Float)\n  duration: number = 2;\n  baseDuration: number = this.duration;\n  durationPercentage: number = 0;\n  currentTime: number = 0;\n  @property(cc.Float)\n  startRadius: number = 150;\n  currentRadius: number = 150;\n  @property(cc.Float)\n  maxRadius: number = 150;\n  @property(cc.Float)\n  angleDelta: number = 0;\n  isInPool: boolean = true;\n  pivot: cc.Node = null;\n  interval = 0.005;\n  time = this.interval;\n  previous: number = 9999;\n  trailList: Array<cc.Node> = new Array<cc.Node>();\n  start() {}\n  onCollisionEnter(other: cc.Collider, self: cc.Collider) {\n    if (other.tag == 1) {\n      other.node.getComponent(EnemyController).takeDamage(this.damage);\n      ShurikenThrower.instance.hitLimit -= 1;\n    }\n  }\n  onLoad(): void {\n    this.node.zIndex = 10000;\n    this.baseDamange = this.damage;\n    this.baseScale = this.weaponScale;\n    this.damagePercentage = 0;\n    this.weaponScalePercentage = 0;\n    this.currentRadius = this.startRadius;\n  }\n  updateStats() {\n    this.damage =\n      (this.damagePercentage / 100) * this.baseDamange + this.baseDamange;\n    this.weaponScale =\n      (this.weaponScalePercentage / 100) * this.baseScale + this.baseScale;\n    this.duration =\n      this.baseDuration + (this.durationPercentage / 100) * this.baseDuration;\n    this.node.scale = this.weaponScale;\n  }\n\n  setStats(\n    damagePercentage: number,\n    bonusDamage: number,\n    weaponScalePercentage: number,\n    durationPercentage: number,\n    pivot: cc.Node,\n    angleDelta: number\n  ) {\n    this.isInPool = false;\n    this.time = this.interval;\n    this.angleDelta = angleDelta;\n    this.currentRadius = this.startRadius;\n    this.currentTime = 0;\n    this.baseDamange = bonusDamage;\n    this.damagePercentage = damagePercentage;\n    this.weaponScalePercentage = weaponScalePercentage;\n    this.pivot = pivot;\n\n    this.durationPercentage = durationPercentage;\n    this.lock = false;\n    this.updateStats();\n  }\n\n  putBackToPool() {\n    if (this.currentTime >= this.duration) {\n      this.isInPool = true;\n      this.trailList.forEach((element) => {\n        ProjectilePooling.instance.putBackToPool(element);\n      });\n      this.trailList.length = 0;\n      ProjectilePooling.instance.putBackToPool(this.node);\n    }\n  }\n\n  forceToPutBack() {\n    this.isInPool = true;\n    this.trailList.forEach((element) => {\n      ProjectilePooling.instance.putBackToPool(element);\n    });\n    this.trailList.length = 0;\n    ProjectilePooling.instance.putBackToPool(this.node);\n  }\n\n  orbitAround(dt: number) {\n    this.addTrail(dt);\n    this.node.angle += dt * 1500;\n    this.angleDelta -= dt * 2.5;\n    if (this.currentRadius > this.maxRadius)\n      this.currentRadius = this.maxRadius;\n    this.node.x = this.pivot.x + this.currentRadius * Math.cos(this.angleDelta);\n    this.node.y = this.pivot.y + this.currentRadius * Math.sin(this.angleDelta);\n  }\n\n  addTrail(dt) {\n    if (this.time > 0) this.time -= dt;\n    else {\n      this.time = this.interval;\n      let clone: cc.Node = null;\n      clone = ProjectilePooling.instance.trailPool.get();\n\n      if (clone == null) {\n        clone = new cc.Node(\"Trail\");\n      }\n\n      this.trailList.push(clone);\n      clone.parent = this.node.parent;\n      clone.scale = this.node.scale;\n      clone.opacity = 200;\n      clone.angle = this.node.angle;\n      clone.zIndex = 9999;\n\n      clone.position = cc.v3(this.node.x, this.node.y);\n      if (clone.getComponent(cc.Sprite) != null)\n        clone.getComponent(cc.Sprite).spriteFrame = this.node.getComponent(\n          cc.Sprite\n        ).spriteFrame;\n      else\n        clone.addComponent(cc.Sprite).spriteFrame = this.node.getComponent(\n          cc.Sprite\n        ).spriteFrame;\n      clone.setContentSize(this.node.getContentSize());\n      cc.tween(clone).to(0.08, { opacity: 0 }).start();\n    }\n  }\n  update(dt) {\n    if (Utils.isPause) return;\n    this.currentTime += dt;\n    this.orbitAround(dt);\n    this.putBackToPool();\n\n    // for (let i = 0; i < this.trailList.length; i++) {\n    //   this.trailList[i].opacity -= dt * 100;\n    // }\n  }\n}\n"]}
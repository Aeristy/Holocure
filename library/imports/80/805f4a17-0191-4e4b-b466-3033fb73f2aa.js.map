{"version":3,"sources":["assets\\Script\\Weapon\\ShurikenThrower.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameController from \"../Controller/GameController\";\nimport Utils from \"../Controller/Utils\";\nimport Item from \"../Item/Item\";\nimport ProjectilePooling from \"../Manager/ProjectilePooling\";\nimport OrbitProjectile from \"./OrbitProjectile\";\nimport Weapon from \"./Weapon\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class ShurikenThrower extends Weapon {\n  static instance: ShurikenThrower;\n  @property(cc.Prefab)\n  shuriken: cc.Prefab = null;\n  @property(cc.Node)\n  player: cc.Node = null;\n  @property(cc.Node)\n  parent: cc.Node = null;\n  timer: number;\n  durationPercentage: number;\n  hitLimit: number = 5;\n  baseHitLimit: number = this.hitLimit;\n  spawnAmount: number = 3;\n  shurikenList: Array<cc.Node> = new Array<cc.Node>();\n  currentLevel = this.level;\n  onLoad() {\n    ShurikenThrower.instance = this;\n    this.durationPercentage = 0;\n    this.weaponOnLoad();\n    this.timer = 0;\n    let initCount = 10;\n    this.description = \"Repels targets with orbiting shurikens.\";\n    for (let i = 0; i < initCount; ++i) {\n      let shuriken = cc.instantiate(this.shuriken);\n      shuriken.parent = this.node.parent.parent;\n      ProjectilePooling.instance.shurikenPool.put(shuriken);\n    }\n  }\n  onLevelUp() {\n    if (this.isLockLevel) return;\n    if (this.currentLevel < this.level) {\n      this.onLevelMax();\n      this.currentLevel = this.level;\n      switch (this.level) {\n        case 1:\n          this.description = \"Add 1 additional shuriken.\";\n          this.isEquiped = true;\n          GameController.instance.addEquipedWeapon(this);\n          break;\n        case 2:\n          this.description =\n            \"Increase damage by 30% and increase duration by 1 second.\";\n\n          this.spawnAmount += 1;\n          break;\n        case 3:\n          this.description = \"Add 1 additional shuriken.\";\n          this.updateStats(30, 0, 0, 0, 0, 50);\n          break;\n        case 4:\n          this.description = \"Increase Damage by 40%.\";\n          this.spawnAmount += 1;\n          break;\n        case 5:\n          this.description = \"Add 1 additional shuriken.\";\n          this.updateStats(40, 0, 0, 0, 0, 0);\n          break;\n        case 6:\n          this.description = \"Increase damage by 40%.\";\n          this.spawnAmount += 1;\n          break;\n        case 7:\n          this.updateStats(40, 0, 0, 0, 0, 0);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n  spawnShuriken(angleDelta: number) {\n    let shuriken: cc.Node = null;\n    if (ProjectilePooling.instance.shurikenPool.size() > 0) {\n      shuriken = ProjectilePooling.instance.shurikenPool.get();\n    } else {\n      shuriken = cc.instantiate(this.shuriken);\n    }\n\n    shuriken.opacity = 0;\n    cc.tween(shuriken).to(0.05, { opacity: 255 }).start();\n    shuriken.parent = this.parent;\n\n    shuriken\n      .getComponent(OrbitProjectile)\n      .setStats(\n        this.resultDamagePercentage,\n        this.baseDamage,\n        this.resultWeaponScalePercentage,\n        this.durationPercentage,\n        this.player,\n        angleDelta\n      );\n    this.shurikenList.push(shuriken);\n  }\n  updateStats(\n    damagePercentage: number,\n    baseDamage: number,\n    hitLimit: number,\n    attackSpeedPercentage: number,\n    weaponScalePercentage: number,\n    durationPercentage: number\n  ) {\n    this.damagePercentage += damagePercentage;\n    this.baseDamage += baseDamage;\n    this.hitLimit += hitLimit;\n    this.attackSpeedPercentage += attackSpeedPercentage;\n    this.weaponScalePercentage += weaponScalePercentage;\n    this.durationPercentage += durationPercentage;\n    this.onStatChange();\n  }\n  throwShuriken() {\n    if (this.timer < 0) {\n      this.timer = this.attackSpeed;\n      this.hitLimit = this.baseHitLimit * this.spawnAmount;\n      for (let i = 0; i < this.spawnAmount; i++) {\n        var angleDelta = (360 / this.spawnAmount) * i * (Math.PI / 180);\n        this.spawnShuriken(angleDelta);\n      }\n    }\n    this.shurikenList = this.shurikenList.filter(\n      (item) => item.getComponent(OrbitProjectile).isInPool !== true\n    );\n  }\n  onNoHitLimit() {\n    if (this.hitLimit <= 0) {\n      this.shurikenList.forEach((element) => {\n        element.getComponent(OrbitProjectile).forceToPutBack();\n      });\n    }\n  }\n\n  start() {}\n\n  update(dt) {\n    this.onLevelUp();\n    if (Utils.isPause) return;\n    if (!this.isEquiped) return;\n    this.timer -= dt;\n    this.throwShuriken();\n    this.onNoHitLimit();\n  }\n}\n"]}
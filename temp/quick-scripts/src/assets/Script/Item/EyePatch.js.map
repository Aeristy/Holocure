{"version":3,"sources":["assets\\Script\\Item\\EyePatch.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameController from \"../Controller/GameController\";\nimport UIController from \"../Controller/UIController\";\nimport Utils from \"../Controller/Utils\";\nimport Item from \"./Item\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class EyePatch extends Item {\n  static instance: EyePatch;\n  @property(cc.Integer)\n  maxCrit: number = 10;\n  @property(cc.Integer)\n  critPerSec: number = 1;\n  @property(cc.SpriteFrame)\n  buffIcon: cc.SpriteFrame = null;\n  timer: number = 1;\n  currentStack: number = 0;\n  currentLevel = this.level;\n  onLoad() {\n    EyePatch.instance = this;\n    this.description =\n      \"Gain 1% crit buff every second up to 10%. If taking damage by a target, lose half the buff.\";\n    this.itemOnLoad();\n  }\n\n  start() {}\n  gainStack() {\n    if (this.timer < 0) {\n      this.timer = this.critPerSec;\n      if (this.currentStack < this.maxCrit) {\n        var oldStack = this.currentStack;\n        this.currentStack += 1;\n        this.overallStats.increaseCritChance(this.currentStack - oldStack);\n      }\n    }\n  }\n  onTakeDamage() {\n    if (!this.isEquiped) return;\n    var oldStack = this.currentStack;\n    this.currentStack = Math.floor(this.currentStack / 2);\n    this.overallStats.increaseCritChance(this.currentStack - oldStack);\n  }\n  updateStats(maxCrit: number) {\n    this.maxCrit += maxCrit;\n  }\n  onLevelUp() {\n    if (this.isLockLevel) return;\n    if (this.currentLevel < this.level) {\n      this.onLevelMax();\n      this.currentLevel = this.level;\n      switch (this.level) {\n        case 1:\n          GameController.instance.dynamicBuff.push(this);\n          UIController.instance.addNewBuff(this);\n          GameController.instance.addEquipedItem(this);\n          this.description =\n            \"Gain 1% crit buff every second up to 15%. If taking damage by a target, lose half the buff.\";\n          this.isEquiped = true;\n          break;\n        case 2:\n          this.description =\n            \"Gain 1% crit buff every second up to 20%. If taking damage by a target, lose half the buff.\";\n          this.updateStats(5);\n          break;\n        case 3:\n          this.updateStats(5);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n  getCounting() {\n    return this.currentStack;\n  }\n\n  update(dt) {\n    this.onLevelUp();\n    if (Utils.isPause) return;\n    if (!this.isEquiped) return;\n    this.timer -= dt;\n    this.gainStack();\n  }\n}\n"]}
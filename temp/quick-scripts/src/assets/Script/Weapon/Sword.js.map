{"version":3,"sources":["assets\\Script\\Weapon\\Sword.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport GameController from \"../Controller/GameController\";\nimport Movement from \"../Controller/Movement\";\nimport Utils from \"../Controller/Utils\";\nimport Melee from \"./Melee\";\nimport StartWeapon from \"./StartWeapon\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Sword extends StartWeapon {\n  static instance: Sword;\n  @property(cc.Node)\n  leftWhip: cc.Node = null;\n  @property(cc.Node)\n  rightWhip: cc.Node = null;\n  @property(cc.AudioClip)\n  slashSound: cc.AudioClip = null;\n  timer: number;\n  stats: Melee = null;\n  statsLeft: Melee = null;\n  currentLevel = this.level;\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    this.weaponOnLoad();\n    Sword.instance = this;\n    this.stats = this.node.getChildByName(\"Right\").getComponent(Melee);\n    this.statsLeft = this.node.getChildByName(\"Left\").getComponent(Melee);\n    this.timer = this.attackSpeed;\n    this.description = \"Swings in a half circle arc in front.\";\n    this.unactiveLeftWhip();\n    this.unactiveRightWhip();\n  }\n\n  onLevelUp() {\n    if (this.isLockLevel) return;\n    if (this.currentLevel < this.level) {\n      this.onLevelMax();\n      this.currentLevel = this.level;\n      switch (this.level) {\n        case 1:\n          this.description = \"Increase damage by 20%.\";\n          this.isEquiped = true;\n          GameController.instance.addEquipedWeapon(this);\n          break;\n        case 2:\n          this.description = \"Add one more attack to the back.\";\n          this.updateSwordStats(0, 20, 0, 0);\n          break;\n        case 3:\n          this.description = \"Increase damage by 30%.\";\n          break;\n        case 4:\n          this.description = \"Reduce the time between attacks by 30%.\";\n          this.updateSwordStats(0, 30, 0, 0);\n          break;\n        case 5:\n          this.description = \"Increase attack area by 30%.\";\n          this.updateSwordStats(0, 0, 30, 0);\n          break;\n        case 6:\n          this.description = \"Increase damage by 40%.\";\n          this.updateSwordStats(0, 0, 0, 30);\n          break;\n        case 7:\n          this.updateSwordStats(0, 40, 0, 0);\n          break;\n        default:\n          break;\n      }\n    }\n    return true;\n  }\n\n  updateSwordStats(\n    bonusBaseDamage: number,\n    damage: number,\n    attackSpeed: number,\n    weaponScale: number\n  ) {\n    this.baseDamage += bonusBaseDamage;\n    this.attackSpeedPercentage += attackSpeed;\n    this.damagePercentage += damage;\n    this.weaponScalePercentage += weaponScale;\n    this.onStatChange();\n  }\n  start() {}\n\n  attackRight() {\n    if (this.timer < 0) {\n      if (Utils.getLocal(\"Sound\") == \"true\")\n        cc.audioEngine.play(this.slashSound, false, 1);\n      this.timer = this.attackSpeed;\n      this.rightWhip.active = true;\n      this.stats.set(\n        this.baseDamage,\n        this.resultDamagePercentage,\n        this.resultWeaponScalePercentage\n      );\n      this.rightWhip.getComponent(cc.Animation).play(\"SlashAnimation\");\n      this.unactiveRightWhip();\n    }\n  }\n  attackLeft() {\n    if (this.timer < 0) {\n      this.timer = this.attackSpeed;\n      if (Utils.getLocal(\"Sound\") == \"true\")\n        cc.audioEngine.play(this.slashSound, false, 1);\n      this.leftWhip.active = true;\n      this.statsLeft.set(\n        this.baseDamage,\n        this.resultDamagePercentage,\n        this.resultWeaponScalePercentage\n      );\n      this.leftWhip.getComponent(cc.Animation).play(\"SlashAnimation\");\n      this.unactiveLeftWhip();\n    }\n  }\n  attackBothSide() {\n    if (this.timer < 0) {\n      this.stats.set(\n        this.baseDamage,\n        this.resultDamagePercentage,\n        this.resultWeaponScalePercentage\n      );\n      this.statsLeft.set(\n        this.baseDamage,\n        this.resultDamagePercentage,\n        this.resultWeaponScalePercentage\n      );\n      if (!Movement.instance.isFlip) {\n        this.timer = this.attackSpeed;\n        if (Utils.getLocal(\"Sound\") == \"true\")\n          cc.audioEngine.play(this.slashSound, false, 1);\n        this.rightWhip.scaleY = this.stats.weaponScaleY * 1;\n        this.rightWhip.active = true;\n        this.rightWhip.getComponent(cc.Animation).play(\"SlashAnimation\");\n\n        this.unactiveRightWhip();\n        setTimeout(() => {\n          if (Utils.getLocal(\"Sound\") == \"true\")\n            cc.audioEngine.play(this.slashSound, false, 1);\n          this.leftWhip.scaleY = this.stats.weaponScaleY * -1;\n          this.leftWhip.active = true;\n          this.leftWhip.getComponent(cc.Animation).play(\"SlashAnimation\");\n          this.unactiveLeftWhip();\n        }, 250);\n      } else {\n        this.timer = this.attackSpeed;\n        if (Utils.getLocal(\"Sound\") == \"true\")\n          cc.audioEngine.play(this.slashSound, false, 1);\n        this.leftWhip.scaleY = this.stats.weaponScaleY * -1;\n        this.leftWhip.active = true;\n        this.leftWhip.getComponent(cc.Animation).play(\"SlashAnimation\");\n        this.unactiveLeftWhip();\n        setTimeout(() => {\n          if (Utils.getLocal(\"Sound\") == \"true\")\n            cc.audioEngine.play(this.slashSound, false, 1);\n          this.rightWhip.scaleY = this.stats.weaponScaleY * 1;\n          this.rightWhip.active = true;\n          this.rightWhip.getComponent(cc.Animation).play(\"SlashAnimation\");\n          this.unactiveRightWhip();\n        }, 250);\n      }\n    }\n  }\n\n  unactiveLeftWhip() {\n    this.scheduleOnce(function () {\n      this.leftWhip.active = false;\n    }, 0.3);\n  }\n  unactiveRightWhip() {\n    this.scheduleOnce(function () {\n      this.rightWhip.active = false;\n    }, 0.3);\n  }\n  perfromAttack() {\n    if (this.timer < 0) {\n      this.node.angle =\n        Math.atan2(\n          Movement.instance.directionVector.y,\n          Movement.instance.directionVector.x\n        ) *\n        (180 / Math.PI);\n      if (Movement.instance.isFlip) {\n        this.node.scaleX = -1;\n      } else this.node.scaleX = 1;\n    }\n\n    if (this.level < 3) {\n      if (!Movement.instance.isFlip) {\n        this.attackRight();\n      } else {\n        this.attackLeft();\n      }\n    }\n    if (this.level >= 3) {\n      this.attackBothSide();\n    }\n  }\n\n  update(dt) {\n    this.onLevelUp();\n    if (Utils.isPause) return;\n    if (!this.isEquiped) return;\n    this.timer -= dt;\n    this.perfromAttack();\n  }\n}\n"]}
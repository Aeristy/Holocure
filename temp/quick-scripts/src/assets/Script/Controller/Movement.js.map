{"version":3,"sources":["assets\\Script\\Controller\\Movement.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlayerController from \"../Player/PlayerController\";\nimport GameController from \"./GameController\";\nimport Utils from \"./Utils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Movement extends cc.Component {\n  static instance: Movement;\n  @property(cc.Node)\n  player: cc.Node = null;\n  @property(cc.Node)\n  directionArrow: cc.Node = null;\n\n  touchAnchor: cc.Vec2;\n  moveVec: cc.Vec2;\n  directionVector: cc.Vec2;\n  directionAngle: number = 0;\n  isFlip = false;\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad() {\n    Movement.instance = this;\n    this.moveVec = cc.Vec2.ZERO;\n    this.directionVector = cc.v2(100, 0);\n\n    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this, true);\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this, true);\n    this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this, true);\n\n    this.node.on(\n      cc.Node.EventType.TOUCH_CANCEL,\n      this.onTouchCancel,\n      this,\n      true\n    );\n    // this.node.on(cc.Node.EventType.MOUSE_MOVE, this.onMouseMove, this, true);\n  }\n  // onMouseMove(event) {\n  //   var mousPos = event.getLocation();\n  //   console.log(mousPos);\n  // }\n  onTouchStart(event) {\n\n    this.touchAnchor = event.touch.getLocation();\n  }\n  onTouchMove(event) {\n    if (Utils.isPause) return;\n    PlayerController.instance.isMoving = true;\n    this.moveVec = event.touch.getLocation();\n    this.moveVec.x -= this.touchAnchor.x;\n    this.moveVec.y -= this.touchAnchor.y;\n    this.directionVector = this.moveVec.normalize();\n  }\n  onTouchEnd(event) {\n    PlayerController.instance.isMoving = false;\n    this.moveVec = cc.Vec2.ZERO;\n  }\n  onTouchCancel(event) {\n    PlayerController.instance.isMoving = false;\n    this.moveVec = cc.Vec2.ZERO;\n  }\n\n  start() {}\n  movePlayer(dt: number) {\n    if (this.moveVec.x < 0 && !this.isFlip) {\n      cc.tween(this.player.getChildByName(\"Player\")).flipX().start();\n      this.isFlip = true;\n    }\n    if (this.moveVec.x > 0 && this.isFlip) {\n      cc.tween(this.player.getChildByName(\"Player\")).flipX().start();\n      this.isFlip = false;\n    }\n    this.player.x +=\n      this.moveVec.normalize().x * PlayerController.instance.speed * 175 * dt;\n    this.player.y +=\n      this.moveVec.normalize().y * PlayerController.instance.speed * 175 * dt;\n    this.node.position = this.player.position;\n  }\n  moveDirectionArrow() {\n    this.directionAngle =\n      Math.atan2(this.directionVector.y, this.directionVector.x) *\n      (180 / Math.PI);\n    this.directionArrow.angle = this.directionAngle;\n    this.directionArrow.position = cc.v3(\n      this.directionVector.normalize().x * 100,\n      this.directionVector.normalize().y * 100\n    );\n  }\n\n  update(dt) {\n    if (Utils.isPause) return;\n    if (GameController.instance.isGameOver) return;\n    this.movePlayer(dt);\n    this.moveDirectionArrow();\n  }\n}\n"]}